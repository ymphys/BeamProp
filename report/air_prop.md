# 电子束在大气中传播的能量损失与束斑扩散

## 一、功能概述
本代码用于模拟一束初始能量约35 MeV电子束在不同高度大气中传播时的主要物理效应，重点估算：

- 电子束的能量衰减与束斑扩展（束流半径变化）；
- 轫致辐射引起的能量展宽导致的电流损失；
- 最终电子束在靶面上的注量率。

## 二、主要物理过程及所用模型

### 1. 空气密度模型
采用简化指数模型表示大气密度随高度变化：
$$
\rho(h) = \rho_0 \exp\left(-\frac{h}{H}\right)
$$

- $\rho_0 = 1.225 \times 10^{-3} \mathrm{g/cm^3}$为空气密度标准大气压（STP）值；
- 标度高度 $H=8.5\,\mathrm{km}$ 为大气密度衰减的经验常数。

### 2. 能量损失 — Bethe-Bloch公式简化版
电子在空气中以接近相对论速度传播时，主要的能量损失机制为电离激发。  
本代码用简化版Bethe-Bloch公式计算单位长度的平均能量损失 $\frac{dE}{dx}$，表达式为：
$$
\frac{dE}{dx} = K \rho \frac{1}{\beta^2} \left[ \frac{1}{2} \ln\left(\frac{2 m_e c^2 \beta^2 \gamma^2 W_{max}}{I^2}\right) - \beta^2 \right]
$$
- $K=0.307\, \mathrm{MeV\,cm^2/g}$；
- $\rho$为空气密度；
- $I\approx 85.7\, \mathrm{eV}$为空气平均激发能；
- $\beta, \gamma$为电子的相对论速度因子和洛伦兹因子；
- $W_{max}$为单次碰撞最大能量转移。

### 3. 多重库仑散射 — Highland公式
电子在穿过空气时受到多次小角度散射，导致束流发散，束斑半径增加。  
本代码用Highland经验公式计算小段路径内RMS散射角 $\theta_0$：
$$
\theta_0 = \frac{13.6\,\mathrm{MeV}}{\beta p c} \sqrt{\frac{x}{X_0}} \left(1 + 0.038 \ln x \right)
$$
- $p$为电子动量；
- $x = \rho L$为空气厚度的质量厚度；
- $X_0=36.66\, \mathrm{g/cm^2}$为空气的辐射长度。

束斑半径通过数值积分散射角平方累积得到：
$$
r = \sqrt{r_0^2 + \sum (L_i \theta_0(L_i))^2}
$$

### 4. 轫致辐射导致的电流损失
高能电子穿过物质时发生的轫致辐射导致随机能量损失，造成束流能量分布展宽。  
假设能量分布为高斯，均值随距离指数衰减：
$$
\langle E \rangle = E_0 e^{-x/X_0}
$$
能量标准差估计为：
$$
\sigma_E = \langle E \rangle \sqrt{\frac{x}{X_0}}
$$
定义能量阈值为初始能量的一半 $E_0/2$，计算能量高于阈值的电子比例：
$$
f = \frac{1}{2}\left[ 1 + \operatorname{erf}\left(\frac{\langle E \rangle - E_0/2}{\sqrt{2} \sigma_E}\right) \right]
$$
因此，剩余电流为：
$$
I = I_0 \times f
$$

### 5. 注量率计算
束流注量率近似用剩余电流和束斑面积估算：
$$
P = \frac{I}{\pi r^2} \times \frac{1}{e}
$$
- 单位为 $\mathrm{cm^{-2} \cdot s^{-1}}$；
- $e$为基本电荷。

### 6. 辐射长度 $X_0$ 与高度的关系
代码中辐射长度 $X_0 = 36.66\, \mathrm{g/cm^2}$ 取为常数，没有随高度变化调整。

- 辐射长度定义为以**质量厚度**计量的材料特性，反映材料中电子发生轫致辐射的概率，与材料的物理密度无关；
- 由于辐射长度单位是 $\mathrm{g/cm^2}$，因此对不同高度的大气，其数值基本恒定；
- 代码通过空气密度 $\rho(h)$ 随高度指数衰减，将物理长度转换成质量厚度，进而反映高度变化对电子传播的影响。

---

## 三、代码执行流程

1. 用户输入高度（km）、传输距离（km）、初始电流（A）；
2. 根据高度计算空气密度；
3. 调用`propagate`函数，数值积分能量损失和散射，得到最终能量和束斑半径；
4. 调用`bremsstrahlung_current_loss`函数，计算轫致辐射引起的能量展宽和剩余电流；
5. 计算注量率，打印最终结果。

---

## 四、适用范围及近似

- 代码采用简化Bethe-Bloch和Highland经验公式，适合**中高能电子（约10~100 MeV）在空气中传播的快速估算**，不适用于极低能或极高能区；
- 空气密度采用指数模型，忽略了季节、纬度等变化；
- 轫致辐射损失模型假设高斯能谱分布，实际能谱具有长尾，且未考虑电子束自身空间电荷效应和集体行为；
- 注量率估算仅为近似，忽略能量依赖的靶材响应及二次粒子产生；
- 衰减和散射计算均基于质量厚度的积分，辐射长度视为常数不随高度变化。

---

该说明文档适合作为代码注释及使用说明。如需格式调整或扩展，可随时告知。
